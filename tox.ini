[tox]
envlist = lint, type, test, test-speed
skipsdist = true

[testenv:lint]
description = Run ruff linter
deps = ruff>=0.8.0
commands = ruff check src/nanasqlite_server tests --output-format=github

[testenv:type]
description = Run mypy type checker
deps = 
    -e .[dev]
    types-colorama
    apsw
commands = mypy src/nanasqlite_server --no-strict-optional

[testenv:format]
description = Format code with ruff
deps = ruff>=0.8.0
commands = ruff format src/nanasqlite_server tests

[testenv:fix]
description = Auto-fix linting issues
deps = ruff>=0.8.0
commands = ruff check src/nanasqlite_server tests --fix

[testenv:test]
description = Run pytest test suite
deps =
    -e .[dev]
setenv =
    PYTHONPATH = {toxinidir}/src
commands =
    pytest -v --tb=short {posargs}

[testenv:test-speed]
description = Run pytest with speed extras (msgpack)
deps =
    -e .[dev,speed]
setenv =
    PYTHONPATH = {toxinidir}/src
commands =
    pytest -v --tb=short
